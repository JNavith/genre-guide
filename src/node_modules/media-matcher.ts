import { readable, Readable } from "svelte/store";

// eslint-disable-next-line consistent-return
export const mediaMatcher = (query: string): Readable<boolean> => readable<boolean>(false, (set) => {
	// @ts-ignore -- doesn't exist until @rollup/plugin-replace makes it
	if (process.browser) {
		const mediaQueryList: MediaQueryList = window.matchMedia(query);
		set(mediaQueryList.matches);

		const handler = (options: { matches: boolean }): void => {
			set(options.matches);
		};

		mediaQueryList.addListener(handler);
		return () => mediaQueryList.removeListener(handler);
	}
});
